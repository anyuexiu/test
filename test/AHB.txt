3.1AHB是新一代AMBA总线协议
组要面向高速、高系统时钟频率、可综合设计
特点：
* 突发传输
* 分裂传输
* 单周期总线主机移交
* 单时钟沿操作
* 非三态设计
* 支持更宽的数据总线

3.1.1 AHB典型连接方式
	AHB能够支持挂载CPU、DMA、外部存储等的高速大数据量的要求
	通过桥实现AHB和APB总线的连接

3.2 总线连接方式
	AHB使用中央多路选择器的互联方案
	通过仲裁来选择使用总线的master，并控制控制/地址和写数据选择器将被选中的master的控制/地址和写数据信号送给所有slave
	另外还有一个译码器通过总线上信息控制读总线上面数据是那个slave的

3.3 AHB操作
	有两个不同类型突发
* 增量突发
* 回环突发

每次传输
* 一个地址和控制周期
* 一个或者多个数据周期（slave通过HREADY来插入等待周期）

HRESP slave响应状态信号
OKAY：传输正常
ERROR：出现异常
RETRY：重传
SPLIT：分裂传输

仲裁可以打断一个插入过多等待周期的传输。出现未传输完的情况master需要重新申请总线

3.4 基本传输（看图说）

* 对写操作，在完成前要保持数据不变
* 对读操作，只需要在最后一个周期保持即可

3.5 传输类型（master发出，并且和控制/地址同周期）HTRANS
* IDLE ：表示空闲，在没有master想要传输时候，总线给予默认主机总线，这个时候就发送IDLE表示没有任何传输。同时slave也要给OKAY来回应
* BUSY ：表示忙，当主机在突发传输的时候，下一个传输没有办法立即产生，于是主机通过类型为BUSY来插入一个等待周期（但是地址必须变为正常下一个传输的地址），slave同样会议OKAY
* NONSEQ ： 表示不连续，单一传输或者是突发的第一个传输使用
* SEQ ： 表示连续，从一次突发的第二个开始的传输

3.6 突发操作

* 增量突发
* 回环突发

HBURST定义了突发节拍和类型

任意一个突发都不能超过过1k地址边界

3.6.1 突发提前终止
通过HTRANS看到非连续，表示上一次突发终止，此次突发开始


3.7 控制信号
3.7.1 传输方向
HWRITE为高表示写，低为读

3.7.2 传输大小
通过HSIZE可以知道当前突发每次传输的字节大小
* 通过HSIZE和HBURST一起定回环地址的边界

3.7.3 保护控制（看表）
通过HPROT来看，但是不是所有主机都能发出正确的HPROT信号

3.8 地址译码
如果master访问一段不存在的空间时，默认slave应该给予ERROR回应，如果是IDLE、BUSY就回应OKAY
默认slave将作为中央译码器一部分来实现

3.9 slave传输响应
3.9.1 传输完成
当HREADY为高时候表示传输完成，为低表示插入等待周期，建议不要插入超过16个等待周期

3.9.2 传输响应（HRESP）
* OKAY ： 完成和等待周期，还有空闲和忙
* ERROR ： 表示出现一个错误，master可以停止突发也可以继续突发
* RETRY ： 重试，表示突发没有完成，master应该继续突发直到完成（重新申请总线）
* SPLIT ： 分裂，表示突发未完成，剩下的后面再传输（从新申请总线）

3.9.3 双周期响应（讲时序图）

3.9.4 错误响应

3.9.5 分裂和重试
* 分裂后的master会被仲裁屏蔽，必须slave同意才会恢复master申请总线
* 重传会让master重新进入仲裁的排序，申请到后会重新传输

3.10 数据总线
HRDATA只有再OKAY时候数据有效

大端小端

不支持动态端结构，会造成多余的电路和速度的降低，功耗的提高

3.11 仲裁
没有SPLIT能力的slave通过观察总线所有权来判断突发的中断

3.11.1 信号描述
* HBUSREQx ：每个master都有，申请总线使用用
* HLOCKx ： 锁定一次突发（在突发前至少保持一个周期）
* HGRANTx ： 总线授权，表示现在你是优先级最高的master在下一个HREADY为高时候，进行总线的移交
* HMASTER ： 给slave看，当前使用总线的master的编号
* HMASTLOCK ： 告诉slave当前的突发是锁定的，请尽快完成（与地址和控制同周期）
* HSPLIT ： slave表示当前可以进行分裂传输，将指定master解除屏蔽

3.11.2 请求总线访问
当master进行一个固定长度的突发，且获得了总线，就没有必要再保持请求信号
如果突发中途被打断，需要再次申请
对未定长度的突发master要到保持申请信号直到之后一次传输发出

3.11.3 授权总线访问（看时序图说）

3.11.4 突发提前终止
如果突发被打断需要重新申请总线，并传输剩下内容

3.11.5 锁定传输
建议在一次锁定突发后插入一个空闲周期
HMASTLOCK和地址和控制信号相同时序


3.11.6 默认master
当所有master都没有申请（或者全部都在SPLIT状态）时候就将总线授予默认master
且默认master发出IDLE

3.12 分裂传输
分裂传输可以在slave无法立刻响应的时候将总线给其他的master使用，提高总线效率，在slave可以处理时候再将对应master启动剩下的传输

多个slave的HSPLIT信号逻辑或一起给仲裁

3.12.1 分裂传输顺序（文档）

3.12.2 多重分裂传输
多个主机对同一个slave进行访问，但是slave忙，只能都给SPLIT回应，并且记住响应的编号，等待不忙时候启动所对应的master

3.12.3 死锁（还是不理解）

3.12.4 分裂传输总线移交（看图所）
 	